- name: Install Podman Desktop
  community.general.homebrew:
    name: homebrew/cask/podman-desktop
    state: present

- name: Install Podman CLI
  community.general.homebrew:
    name: podman
    state: present
    install_options:
      - '--formula'

# TODO: This is implemented by Podman desktop
#- name: Run Podman on boot
#  ansible.builtin.shell:
#    cmd: brew services start podman

- name: Create a Podman machine, with a home-directory mount
  ansible.builtin.shell:
    cmd: podman machine init --volume "$HOME:$HOME"
  ignore_errors: true  # TODO: Trap Error: podman-machine-default: VM already exists

# TODO: Does this vm start on podman service start?
- name: Start the Podman machine
  ansible.builtin.shell:
    cmd: podman machine start
  ignore_errors: true  # TODO: Error: unable to start "podman-machine-default": machine podman-machine-default: VM already running or starting"

# TODO: Consider installing the docker-host helper
# The system helper service is not installed; the default Docker API socket
# address can't be used by podman. If you would like to install it, run the following commands:
#
#         sudo /opt/homebrew/Cellar/podman/5.0.2/bin/podman-mac-helper install
#         podman machine stop; podman machine start
